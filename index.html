<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Rezerwacji Termin√≥w</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f0f2f5 50%, #e8f5e9 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 18px;
            color: #666;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: block;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #7cb342 0%, #689f38 100%);
        }

        .card:nth-child(2)::before {
            background: linear-gradient(90deg, #42a5f5 0%, #1976d2 100%);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }

        .card h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .card p {
            font-size: 15px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .card-features {
            list-style: none;
            margin-top: 20px;
        }

        .card-features li {
            font-size: 14px;
            color: #555;
            margin-bottom: 8px;
            padding-left: 24px;
            position: relative;
        }

        .card-features li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #7cb342;
            font-weight: bold;
        }

        .card:nth-child(2) .card-features li::before {
            color: #1976d2;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #7cb342;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            background: #689f38;
            transform: scale(1.05);
        }

        .bookings-section {
            margin-top: 60px;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .bookings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .bookings-header h2 {
            font-size: 24px;
            color: #333;
            font-weight: 600;
        }

        .bookings-count {
            background: #f5f5f5;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: #666;
        }

        .bookings-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .booking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #7cb342;
            transition: all 0.2s;
        }

        .booking-item:hover {
            background: #f1f8e9;
            transform: translateX(5px);
        }

        .booking-info {
            flex: 1;
        }

        .booking-date {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .booking-time {
            font-size: 14px;
            color: #666;
        }

        .booking-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-delete {
            background: #ffebee;
            color: #c62828;
        }

        .btn-delete:hover {
            background: #ffcdd2;
        }

        .btn-export {
            background: #e3f2fd;
            color: #1976d2;
        }

        .btn-export:hover {
            background: #bbdefb;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 16px;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #e0e0e0;
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 28px;
            }

            .cards {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 30px;
            }

            .bookings-section {
                padding: 30px 20px;
            }

            .booking-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .booking-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÖ System Rezerwacji Termin√≥w</h1>
            <p>ZarzƒÖdzaj harmonogramami i rezerwuj spotkania</p>
        </div>

        <div class="cards">
            <a href="planowanie_harmonogramu_20251017.html" class="card">
                <span class="card-icon">üìã</span>
                <h2>Utw√≥rz harmonogram</h2>
                <p>Stw√≥rz nowy harmonogram spotka≈Ñ, zdefiniuj dostƒôpne terminy i wygeneruj link do udostƒôpnienia.</p>
                <ul class="card-features">
                    <li>Definiowanie okien dostƒôpno≈õci</li>
                    <li>Przypisywanie do u≈ºytkownik√≥w</li>
                    <li>Generowanie link√≥w publicznych</li>
                    <li>Walidacja w czasie rzeczywistym</li>
                </ul>
                <span class="btn">Otw√≥rz formularz ‚Üí</span>
            </a>

            <a href="wybor_terminu_20251017.html" class="card">
                <span class="card-icon">üóìÔ∏è</span>
                <h2>Wybierz termin</h2>
                <p>PrzeglƒÖdaj dostƒôpne terminy w interaktywnym kalendarzu i zarezerwuj spotkanie.</p>
                <ul class="card-features">
                    <li>Interaktywny kalendarz</li>
                    <li>Wyb√≥r dostƒôpnych slot√≥w</li>
                    <li>Filtrowanie po dacie</li>
                    <li>Responsywny design</li>
                </ul>
                <span class="btn" style="background: #1976d2;">Otw√≥rz kalendarz ‚Üí</span>
            </a>
        </div>

        <div class="bookings-section" style="margin-top: 40px;">
            <div class="bookings-header">
                <h2>üìÖ Utworzone harmonogramy</h2>
                <div class="bookings-count" id="schedulesCount">0 harmonogram√≥w</div>
            </div>
            <div class="bookings-list" id="schedulesList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>Brak utworzonych harmonogram√≥w</p>
                    <p style="font-size: 14px; margin-top: 10px;">Utw√≥rz harmonogram, aby dodaƒá dostƒôpne terminy</p>
                </div>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn-small btn-export" onclick="exportSchedules()" id="exportSchedulesBtn" style="display: none;">
                    üì• Eksportuj harmonogramy
                </button>
            </div>
        </div>

        <div class="bookings-section">
            <div class="bookings-header">
                <h2>üìã Zarezerwowane terminy</h2>
                <div class="bookings-count" id="bookingsCount">0 rezerwacji</div>
            </div>
            <div class="bookings-list" id="bookingsList">
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <p>Brak zarezerwowanych termin√≥w</p>
                    <p style="font-size: 14px; margin-top: 10px;">Zarezerwuj termin, aby zobaczyƒá go tutaj</p>
                </div>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn-small btn-export" onclick="exportBookings()" id="exportBtn" style="display: none;">
                    üì• Eksportuj do JSON
                </button>
                <button class="btn-small btn-delete" onclick="clearAllBookings()" id="clearBtn" style="display: none;">
                    üóëÔ∏è Wyczy≈õƒá wszystkie
                </button>
            </div>
        </div>

        <div class="footer">
            <p>System Rezerwacji Termin√≥w ¬© 2025</p>
        </div>
    </div>

    <script>
        // ========== SCHEDULE MANAGEMENT ==========
        
        /**
         * Get all schedules from localStorage
         */
        function getSchedules() {
            try {
                return JSON.parse(localStorage.getItem('schedules') || '[]');
            } catch (error) {
                console.error('B≈ÇƒÖd odczytu harmonogram√≥w:', error);
                return [];
            }
        }

        /**
         * Remove schedule by ID
         */
        function removeSchedule(id) {
            if (confirm('Czy na pewno chcesz usunƒÖƒá ten harmonogram? Wszystkie powiƒÖzane rezerwacje pozostanƒÖ.')) {
                const schedules = getSchedules();
                const filtered = schedules.filter(s => s.id !== id);
                localStorage.setItem('schedules', JSON.stringify(filtered));
                displaySchedules();
            }
        }

        /**
         * Export schedules to JSON file
         */
        function exportSchedules() {
            const schedules = getSchedules();
            if (schedules.length === 0) {
                alert('Brak harmonogram√≥w do eksportu');
                return;
            }

            const dataStr = JSON.stringify(schedules, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `harmonogramy_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        /**
         * Get booking count for a schedule
         */
        function getBookingCountForSchedule(scheduleId) {
            const bookings = getBookings();
            return bookings.filter(b => b.scheduleId === scheduleId).length;
        }

        /**
         * Get total available slots for a schedule
         */
        function getTotalSlotsForSchedule(schedule) {
            let total = 0;
            schedule.timeSlots.forEach(slot => {
                const date = new Date(slot.date);
                const fromMinutes = timeToMinutes(slot.timeFrom);
                const toMinutes = timeToMinutes(slot.timeTo);
                const duration = schedule.duration || 60;
                total += Math.floor((toMinutes - fromMinutes) / duration);
            });
            return total;
        }

        /**
         * Convert time string to minutes
         */
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        /**
         * Display all schedules
         */
        function displaySchedules() {
            const schedules = getSchedules();
            const container = document.getElementById('schedulesList');
            const countElement = document.getElementById('schedulesCount');
            const exportBtn = document.getElementById('exportSchedulesBtn');

            // Update count
            countElement.textContent = `${schedules.length} ${schedules.length === 1 ? 'harmonogram' : 'harmonogram√≥w'}`;

            // Show/hide export button
            if (schedules.length > 0) {
                exportBtn.style.display = 'inline-block';
            } else {
                exportBtn.style.display = 'none';
            }

            // Clear container
            container.innerHTML = '';

            if (schedules.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>Brak utworzonych harmonogram√≥w</p>
                        <p style="font-size: 14px; margin-top: 10px;">Utw√≥rz harmonogram, aby dodaƒá dostƒôpne terminy</p>
                    </div>
                `;
                return;
            }

            // Sort schedules by creation date (newest first)
            const sortedSchedules = [...schedules].sort((a, b) => {
                const dateA = new Date(a.createdAt || 0);
                const dateB = new Date(b.createdAt || 0);
                return dateB - dateA;
            });

            // Create schedule items
            sortedSchedules.forEach(schedule => {
                const item = document.createElement('div');
                item.className = 'booking-item';
                
                const bookingCount = getBookingCountForSchedule(schedule.id);
                const totalSlots = getTotalSlotsForSchedule(schedule);
                const availableSlots = totalSlots - bookingCount;
                
                const dateStr = new Date(schedule.createdAt).toLocaleDateString('pl-PL', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                item.innerHTML = `
                    <div class="booking-info">
                        <div class="booking-date">${schedule.title || 'Harmonogram bez nazwy'}</div>
                        <div class="booking-time">
                            <strong>Typ:</strong> ${schedule.meetingType || 'Nieokre≈õlony'} | 
                            <strong>Przypisany do:</strong> ${schedule.assignedUser || 'Nieprzypisany'} | 
                            <strong>Czas trwania:</strong> ${schedule.duration || 60} min
                        </div>
                        <div class="booking-time" style="margin-top: 8px; font-size: 12px; color: #999;">
                            üìÖ Utworzono: ${dateStr} | 
                            üìä Dostƒôpne sloty: ${availableSlots}/${totalSlots} | 
                            üîó <a href="${schedule.link || '#'}" target="_blank" style="color: #7cb342;">Link publiczny</a>
                        </div>
                    </div>
                    <div class="booking-actions">
                        <button class="btn-small btn-delete" onclick="removeSchedule('${schedule.id}')" aria-label="Usu≈Ñ harmonogram">
                            Usu≈Ñ
                        </button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // ========== BOOKING MANAGEMENT ==========
        
        /**
         * Get all bookings from localStorage
         */
        function getBookings() {
            try {
                return JSON.parse(localStorage.getItem('bookings') || '[]');
            } catch (error) {
                console.error('B≈ÇƒÖd odczytu rezerwacji:', error);
                return [];
            }
        }

        /**
         * Remove booking by ID
         */
        function removeBooking(id) {
            const bookings = getBookings();
            const filtered = bookings.filter(b => b.id !== id);
            localStorage.setItem('bookings', JSON.stringify(filtered));
            displayBookings();
        }

        /**
         * Clear all bookings
         */
        function clearAllBookings() {
            if (confirm('Czy na pewno chcesz usunƒÖƒá wszystkie rezerwacje?')) {
                localStorage.removeItem('bookings');
                displayBookings();
            }
        }

        /**
         * Export bookings to JSON file
         */
        function exportBookings() {
            const bookings = getBookings();
            if (bookings.length === 0) {
                alert('Brak rezerwacji do eksportu');
                return;
            }

            const dataStr = JSON.stringify(bookings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `rezerwacje_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        /**
         * Format date for display
         */
        function formatBookingDate(booking) {
            if (booking.dateString) {
                return booking.dateString;
            }
            if (booking.displayDate && booking.time) {
                return `${booking.displayDate} o ${booking.time}`;
            }
            if (booking.date && booking.time) {
                // Try to format ISO date
                try {
                    const date = new Date(booking.date);
                    const formatted = date.toLocaleDateString('pl-PL', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    return `${formatted} o ${booking.time}`;
                } catch (e) {
                    return `${booking.date} o ${booking.time}`;
                }
            }
            return 'Nieznana data';
        }

        /**
         * Display all bookings
         */
        function displayBookings() {
            const bookings = getBookings();
            const container = document.getElementById('bookingsList');
            const countElement = document.getElementById('bookingsCount');
            const exportBtn = document.getElementById('exportBtn');
            const clearBtn = document.getElementById('clearBtn');

            // Update count
            countElement.textContent = `${bookings.length} ${bookings.length === 1 ? 'rezerwacja' : 'rezerwacji'}`;

            // Show/hide buttons
            if (bookings.length > 0) {
                exportBtn.style.display = 'inline-block';
                clearBtn.style.display = 'inline-block';
            } else {
                exportBtn.style.display = 'none';
                clearBtn.style.display = 'none';
            }

            // Clear container
            container.innerHTML = '';

            if (bookings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>Brak zarezerwowanych termin√≥w</p>
                        <p style="font-size: 14px; margin-top: 10px;">Zarezerwuj termin, aby zobaczyƒá go tutaj</p>
                    </div>
                `;
                return;
            }

            // Sort bookings by date (newest first)
            const sortedBookings = [...bookings].sort((a, b) => {
                const dateA = new Date(a.fullDate || a.createdAt);
                const dateB = new Date(b.fullDate || b.createdAt);
                return dateB - dateA;
            });

            // Create booking items
            sortedBookings.forEach(booking => {
                const item = document.createElement('div');
                item.className = 'booking-item';
                
                const dateStr = formatBookingDate(booking);
                const timeStr = booking.time || '';
                
                item.innerHTML = `
                    <div class="booking-info">
                        <div class="booking-date">${dateStr}</div>
                        ${timeStr ? `<div class="booking-time">üïê ${timeStr}</div>` : ''}
                    </div>
                    <div class="booking-actions">
                        <button class="btn-small btn-delete" onclick="removeBooking('${booking.id}')" aria-label="Usu≈Ñ rezerwacjƒô">
                            Usu≈Ñ
                        </button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // ========== INITIALIZATION ==========
        // Display schedules and bookings on page load
        displaySchedules();
        displayBookings();

        // Refresh bookings when page becomes visible (in case user comes back from booking page)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                displayBookings();
            }
        });

        // Also refresh when page gets focus
        window.addEventListener('focus', () => {
            displaySchedules();
            displayBookings();
        });
    </script>
</body>
</html>

